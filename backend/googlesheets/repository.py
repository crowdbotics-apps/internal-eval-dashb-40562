import builtins
import logging
import pprint
from itertools import zip_longest

from google.oauth2 import service_account
from googleapiclient.discovery import build
from django.conf import settings


logger = logging.getLogger(__name__)


class GoogleSheetsRepository:

    @staticmethod
    def execute():
        return main()


def make_dicts(header, values):
    return [dict(zip_longest(header, v, fillvalue=None)) for v in values]


def main():
    # Authenticate the API using the service account credentials
    creds = service_account.Credentials.from_service_account_info(
        info=settings.GOOGLE_SERVICE_ACCOUNT
    )
    service = build('sheets', 'v4', credentials=creds)

    # Get the data from the first sheet as a JSON
    spreadsheet_metadata = service.spreadsheets().get(
        spreadsheetId=settings.SPREADSHEET_ID
    ).execute()

    sheet_name = spreadsheet_metadata['sheets'][2]['properties']['title']
    range_name = f'{sheet_name}!A1:Z'
    sheet_data = (
        service.spreadsheets()
        .values()
        .get(spreadsheetId=settings.SPREADSHEET_ID, range=range_name, alt='json')
        .execute()
    )

    # Return the JSON data
    try:
        keys = sheet_data["values"][0]
        answers = sheet_data["values"][1:]
        zipped = make_dicts(keys, answers)
        return zipped
    except builtins.Exception as err:
        logger.error(f"Error trying to fetch data from Googe API: {err}")



"""{
    'range': "'Results (READ ONLY)'!A1:Z119",
    'majorDimension': 'ROWS',
    'values': [
        [
            'Timestamp',
            'Email Address',
            'Contractor Name',
            'Contractor CB Email',
            "Project (If more than one, we'd prefer that you repeat the survey for each project)",
            "Link to the project's PRD \n\n(Will be used to measure the goals achieved by the developer)",
            'Job Role',
            'Technical Skill(s) (i.e. React Native, Django, etc.)',
            '1. The technical skills of this contributor are good',
            'Based on the expectations framework, rate the technical skills of this contributor.',
            '2. The project management skills of this contributor are good',
            'Based on the expectations framework, rate the project management skills of this contributor.',
            '3. The productivity levels of this contributor are good',
            'Based on the expectations framework, rate the productivity levels of this contributor.',
            '4. This contributor delivers on time',
            'Based on the expectations framework, rate the ability to deliver on time of this contributor.',
            '5. This contributor has good communication skills and is available in meetings and on Slack',
            'Based on the expectations framework, rate the communication skills of this contributor.',
            '6. The Code Quality of this contributor is good',
            'Based on the expectations framework, rate the code quality of this contributor.',
            '8. This contributor has ability to work independently without much handholding',
            'Based on the expectations framework, rate the ability to work independently of this contributor.',
            '9. This contributor is reliable with more complex tasks/clients',
            'Based on the expectations framework, rate the reliability of this contributor.',
            'In overall, this contributor met the goals of this project*\n\n*based on the project goals set in the PRD',
            'Summary: This contributor should remain in the Crowdbotics community',
        ],
        ['', '', 'Javier Angel', 'javier.angel@crowdbotics.com'],
        ['', '', 'Goran Markovic', 'goran@crowdbotics.com'],
        ['', '', 'Yunan Kholilul Fatah', 'yunan.fatah@crowdbotics.com'],
        ['', '', 'adeel B.', 'adeel.baig@crowdbotics.com'],
        ['', '', 'Kalpit Jain', 'kalpit@crowdbotics.com'],
        ['', '', 'Al Amin Raju', 'alamin.raju@crowdbotics.com'],
        ['', '', 'Akhitha Manjitha', 'akhitha.manjitha@crowdbotics.com'],
        ['', '', 'Ambe Elvis', 'ambe.elvis@crowdbotics.com'],
        ['', '', 'Muhammad Maaz', 'muhammad.maaz@crowdbotics.com'],
        ['', '', 'Muhammad Fahad Khan', 'muhammadfahad.khan@crowdbotics.com'],
        ['', '', 'Zarish Iqbal', 'zarish.iqbal@crowdbotics.com'],
        ['', '', 'Maisam Shah', 'maisam.shah@crowdbotics.com'],
        ['', '', 'Oleh Shebets', 'oleh.shebets@crowdbotics.com'],
        ['', '', 'Zeeshan Mazhar', 'zeeshan.mazhar@crowdbotics.com'],
        ['', '', 'Mintesnot Yismaw', 'mintesnot.yismaw@crowdbotics.com'],
        ['', '', 'Valentina Artari ', 'valentina.artari@crowdbotics.com'],
        ['', '', 'Afnan Hassan', 'afnan.hassan@crowdbotics.com'],
        ['', '', 'Hamza Mushtaq', 'hamza.mushtaq@crowdbotics.com'],
        ['', '', 'Tobi Odeyale', 'tobi.odeyale@crowdbotics.com'],
        ['', '', 'Awais Khan', 'awais.khan@crowdbotics.com'],
        ['', '', 'Daniel Nziranziza', 'daniel.nziranziza@crowdbotics.com'],
        ['', '', 'Daniel Nziranziza', 'daniel.nziranziza@crowdbotics.com'],
        ['', '', 'Moh Bell', 'Moh.Bell@crowdbotics.com'],
        ['', '', 'Aaron Sekisambu', 'sekisambu.aaron@crowdbotics.com'],
        ['', '', 'Jean Pierre', 'jean.baraka@crowdbotics.com'],
        ['', '', 'Vlad Rimsha', 'vlad@crowdbotics.com'],
        ['', '', 'Owolabi Badmus', 'owolabi.badmus@crowdbotics.com'],
        ['', '', 'Elene Botchorzade', 'eleniko.bochoradze@crowdbotics.com'],
        ['', '', 'Ahad Jeyemby', 'ahad.jeyemby@crowdbotics.com'],
        ['', '', 'Ahad Jeyemby', 'ahad.jeyemby@crowdbotics.com'],
        ['', '', 'Saad Abid', 'saad.abid@crowdbotics.com'],
        ['', '', 'Irzam Tariq', 'irzam.tariq@crowdbotics.com'],
        ['', '', 'Usama Shahid', 'usama.shahid@crowdbotics.com'],
        ['', '', 'Syed Zohaib Abbas', 'syedzohaib.abbas@crowdbotics.com'],
        ['', '', 'Charles Apochi', 'charles.apochi@crowdbotics.com'],
        ['', '', 'Farrukh Razzaq Butt', 'farrukhrazzaq.butt@crowdbotics.com'],
        ['', '', 'Abdullah Adeel', 'mabdullah.adeel@crowdbotics.com'],
        ['', '', 'Timothy', 'timothy@crowdbotics.com'],
        ['', '', 'Abeer Ahmad', 'abeer.ahmad@crowdbotics.com'],
        ['', '', 'Abeer Ahmad', 'abeer.ahmad@crowdbotics.com'],
        ['', '', 'Sam Bursh', 'samuel.brush@crowdbotics.com'],
        ['', '', 'Muhammad Mohsin', 'muhammad.mohsin@crowdbotics.com'],
        ['', '', 'Andre Machado', 'andre@crowdbotics.com'],
        ['', '', 'Hamza Khursheed', 'hamza.khursheed@crowdbotics.com'],
        ['', '', 'Ali Abdullah', 'ali.abdullah@crowdbotics.com'],
        ['', '', 'Mateja Najdanov', 'mateja.najdanov@crowdbotics.com'],
        [
            '3/21/2023 18:02:55',
            'andre.machado@crowdbotics.com',
            'Testing 01',
            'testing@crowdbotics.com',
            'Project Testing',
            'project.com',
            'Backend Engineer',
            'Django',
            'Yes',
            '8',
            'Yes',
            '7',
            'Yes',
            '6',
            'No',
            '5',
            'Yes',
            '10',
            'No',
            '6',
            'Yes',
            '9',
            'Yes',
            '9',
            'Yes',
            'Yes',
        ],
        [
            '4/6/2023 13:11:37',
            'ayema@crowdbotics.com',
            'testing 01',
            'testing@crowdbotics.com',
            'project.com',
            '',
            'Frontend Engineer',
            'React Native',
            'No',
            '2',
            'No',
            '3',
            'No',
            '2',
            'No',
            '1',
            'No',
            '1',
            'No',
            '3',
            'No',
            '2',
            'No',
            '2',
            'No',
            'No',
        ],
        [
            '4/7/2023 17:04:27',
            'mathebula.percy@crowdbotics.com',
            'Mia Manic',
            'mia.manic@crowdbotics.com',
            '1',
            '',
            'Designer',
            'Other',
            'Yes',
            '8',
            'Yes',
            '8',
            'Yes',
            '8',
            'Yes',
            '8',
            'Yes',
            '7',
            'Yes',
            '8',
            'Yes',
            '8',
            'Yes',
            '8',
            'Yes',
            'Yes',
        ],
        [
            '4/7/2023 17:06:44',
            'mathebula.percy@crowdbotics.com',
            'Bindeep Acharya',
            'bindeep.acharya@crowdbotics.com',
            '1',
            '',
            'Backend Engineer',
            'Django',
            'Yes',
            '9',
            'Yes',
            '9',
            'Yes',
            '9',
            'Yes',
            '9',
            'Yes',
            '8',
            'Yes',
            '9',
            'Yes',
            '9',
            'Yes',
            '9',
            'Yes',
            'Yes',
        ],
        [
            '4/10/2023 10:29:42',
            'abubakar.prince@crowdbotics.com',
            'Naveen Kumar Saini',
            'naveen.saini@crowdbotics.com',
            'Gapless Music App',
            '',
            'Frontend Engineer',
            'React Native',
            'No',
            '3',
            'No',
            '4',
            'No',
            '3',
            'No',
            '1',
            'No',
            '1',
            'No',
            '1',
            'No',
            '1',
            'No',
            '3',
            'No',
            'Yes',
        ],
        [
            '4/18/2023 14:38:09',
            'mathebula.percy@crowdbotics.com',
            'Kiranbir Singh',
            'kiranbir.singh@crowdbotics.com',
            '1',
            '',
            'Frontend Engineer',
            'React Native',
            'Yes',
            '5',
            'No',
            '5',
            'No',
            '5',
            'No',
            '5',
            'No',
            '5',
            'No',
            '5',
            'No',
            '5',
            'No',
            '5',
            'No',
            'Yes',
        ],
        [
            '4/20/2023 5:01:34',
            'mahomed.yerally@crowdbotics.com',
            'Kiranbir Singh',
            'kiranbir.singh@crowdbotics.com',
            'Utomea',
            '',
            'Frontend Engineer',
            'Other',
            'Yes',
            '7',
            'No',
            '5',
            'No',
            '6',
            'No',
            '5',
            'No',
            '4',
            'Yes',
            '6',
            'No',
            '5',
            'No',
            '6',
            'Yes',
            'No',
        ],
        [
            '4/24/2023 13:04:29',
            'rakesh.dhiman@crowdbotics.com',
            'Wasif Jameel',
            'wasif.jameel@crowdbotics.com',
            'Sweet Scene',
            '',
            'Frontend Engineer',
            'React.JS',
            'Yes',
            '9',
            'Yes',
            '10',
            'Yes',
            '9',
            'Yes',
            '9',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            'Yes',
        ],
        [
            '4/26/2023 19:18:20',
            'joy.moses@crowdbotics.com',
            'maham Iqbal',
            'maham.iqbal@crowdbotics.com',
            'Maxim Fitness',
            '',
            'Frontend Engineer',
            'React Native',
            'Yes',
            '6',
            'Yes',
            '6',
            'Yes',
            '7',
            'No',
            '5',
            'Yes',
            '8',
            'Yes',
            '6',
            'Yes',
            '6',
            'Yes',
            '7',
            'Yes',
            'Yes',
        ],
        [
            '4/27/2023 7:16:59',
            'victor.cheruiyot@crowdbotics.com',
            'Alvaro Machuca',
            'alvaro.machuca@crowdbotics.com',
            'Joie (Green Forest)',
            '',
            'Backend Engineer',
            'Django',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            'Yes',
        ],
        [
            '5/2/2023 16:05:16',
            'abubakar.prince@crowdbotics.com',
            'Stefan Parezanovic',
            'stefan.parezanovic@crowdbotics.com',
            'Gapless Music',
            '',
            'Frontend Engineer',
            'React Native',
            'Yes',
            '5',
            'Yes',
            '5',
            'Yes',
            '5',
            'Yes',
            '5',
            'Yes',
            '5',
            'Yes',
            '5',
            'No',
            '5',
            'Yes',
            '5',
            'Yes',
            'Yes',
        ],
        [
            '5/8/2023 7:14:24',
            'ahmed.eweyeju@crowdbotics.com',
            'Tony Ibrahim',
            'tony.ibrahim@crowdbotics.com',
            'Learn Abacus Soroban / Simple Abacus Soroban',
            '',
            'Frontend Engineer',
            'React Native',
            'Yes',
            '7',
            'Yes',
            '5',
            'Yes',
            '7',
            'Yes',
            '6',
            'Yes',
            '6',
            'Yes',
            '7',
            'Yes',
            '6',
            'Yes',
            '6',
            'Yes',
            'Yes',
        ],
        [
            '5/8/2023 17:40:50',
            'ayema@crowdbotics.com',
            'Testing 01',
            'testing@crowdbotics.com',
            'xyz',
            '',
            'Frontend Engineer',
            'Node.JS',
            'Yes',
            '3',
            'Yes',
            '7',
            'Yes',
            '7',
            'No',
            '2',
            'Yes',
            '1',
            'No',
            '2',
            'Yes',
            '9',
            '',
            '2',
            'No',
            'Yes',
        ],
        [
            '5/8/2023 18:23:16',
            'andre.machado@crowdbotics.com',
            'Andre',
            'andre.machado@crowdbotics.com',
            'Tst',
            '',
            'Backend Engineer',
            'Django',
            'Yes',
            '5',
            'Yes',
            '10',
            'Yes',
            '10',
            'Yes',
            '5',
            'Yes',
            '1',
            'No',
            '4',
            'No',
            '7',
            'Yes',
            '1',
            'Yes',
            'Yes',
        ],
    ],
}"""
